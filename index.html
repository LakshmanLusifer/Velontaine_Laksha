<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üíñ Will You Be My Valentine? üíñ</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Dancing+Script:wght@700&display=swap" rel="stylesheet" />
  <style>
    /* =============================================
       CSS CUSTOM PROPERTIES & RESET
    ============================================= */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --rose:       #ff2d55;
      --deep-rose:  #c9003c;
      --blush:      #ffb3c6;
      --peach:      #ffd6cc;
      --gold:       #ffd700;
      --lavender:   #e8c7f3;
      --cream:      #fff8f0;
      --white:      #ffffff;
      --shadow:     rgba(200, 0, 60, 0.25);
    }

    html, body {
      width: 100%; height: 100%;
      overflow-x: hidden;
    }

    body {
      font-family: 'Cormorant Garamond', serif;
      background: #1a0010;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%23ff2d55' d='M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402z'/%3E%3C/svg%3E") 12 12, pointer;
    }

    /* =============================================
       ANIMATED GRADIENT BACKGROUND
    ============================================= */
    .bg-layer {
      position: fixed;
      inset: 0;
      z-index: 0;
      background: linear-gradient(135deg,
        #1a0010 0%,
        #3d0020 20%,
        #6b0035 40%,
        #3d0020 60%,
        #1a0010 80%,
        #2d0018 100%
      );
      background-size: 400% 400%;
      animation: gradientShift 8s ease infinite;
    }

    @keyframes gradientShift {
      0%   { background-position: 0%   50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0%   50%; }
    }

    /* radial glow blobs */
    .glow-blob {
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.35;
      z-index: 1;
      animation: blobFloat 12s ease-in-out infinite;
    }
    .glow-blob-1 { width: 500px; height: 500px; background: #ff2d55; top: -100px; left: -150px; animation-delay: 0s; }
    .glow-blob-2 { width: 400px; height: 400px; background: #c9003c; bottom: -80px; right: -100px; animation-delay: -4s; }
    .glow-blob-3 { width: 300px; height: 300px; background: #ff6b8a; top: 40%; left: 60%; animation-delay: -8s; }

    @keyframes blobFloat {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33%       { transform: translate(30px, -40px) scale(1.1); }
      66%       { transform: translate(-20px, 20px) scale(0.9); }
    }

    /* =============================================
       FLOATING AMBIENT HEARTS (background)
    ============================================= */
    .ambient-hearts-container {
      position: fixed;
      inset: 0;
      z-index: 2;
      pointer-events: none;
      overflow: hidden;
    }

    .ambient-heart {
      position: absolute;
      bottom: -60px;
      font-size: var(--size, 20px);
      opacity: 0;
      animation: ambientRise var(--dur, 8s) ease-in var(--delay, 0s) infinite;
      left: var(--x, 50%);
      filter: drop-shadow(0 0 6px rgba(255,45,85,0.6));
    }

    @keyframes ambientRise {
      0%   { opacity: 0;    transform: translateY(0)     rotate(0deg)   scale(0.5); }
      10%  { opacity: 0.7; }
      90%  { opacity: 0.4; }
      100% { opacity: 0;    transform: translateY(-110vh) rotate(360deg) scale(1.3); }
    }

    /* =============================================
       MAIN CARD
    ============================================= */
    .card {
      position: relative;
      z-index: 10;
      max-width: 680px;
      width: 90%;
      background: rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 180, 190, 0.2);
      border-radius: 32px;
      padding: 56px 48px 52px;
      text-align: center;
      box-shadow:
        0 0 60px rgba(255, 45, 85, 0.2),
        0 30px 80px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255,200,210,0.15);
      animation: cardEntrance 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
    }

    @keyframes cardEntrance {
      0%   { opacity: 0; transform: translateY(60px) scale(0.85); }
      100% { opacity: 1; transform: translateY(0)    scale(1); }
    }

    /* decorative corner hearts */
    .card::before, .card::after {
      content: '‚ù§';
      position: absolute;
      font-size: 22px;
      opacity: 0.3;
      animation: cornerPulse 3s ease-in-out infinite;
    }
    .card::before { top: 18px; left: 22px; animation-delay: 0s; }
    .card::after  { bottom: 18px; right: 22px; animation-delay: -1.5s; }

    @keyframes cornerPulse {
      0%, 100% { transform: scale(1); opacity: 0.3; }
      50%       { transform: scale(1.4); opacity: 0.6; }
    }

    /* =============================================
       TYPOGRAPHY
    ============================================= */
    .eyebrow {
      font-family: 'Dancing Script', cursive;
      font-size: clamp(1.1rem, 2.5vw, 1.4rem);
      color: var(--blush);
      letter-spacing: 0.06em;
      margin-bottom: 10px;
      opacity: 0;
      animation: fadeSlideUp 0.8s ease 0.4s forwards;
    }

    .headline {
      font-family: 'Playfair Display', serif;
      font-size: clamp(2.2rem, 6vw, 3.8rem);
      font-weight: 900;
      font-style: italic;
      line-height: 1.1;
      background: linear-gradient(135deg, #fff8f0 0%, #ffb3c6 40%, #ff2d55 80%, #ffd700 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 28px;
      opacity: 0;
      animation: fadeSlideUp 0.8s ease 0.65s forwards;
    }

    .headline .heart-icon {
      display: inline-block;
      -webkit-text-fill-color: #ff2d55;
      animation: heartBeat 1.2s ease-in-out infinite;
      filter: drop-shadow(0 0 10px #ff2d55);
    }

    @keyframes heartBeat {
      0%, 100% { transform: scale(1); }
      14%       { transform: scale(1.3); }
      28%       { transform: scale(1); }
      42%       { transform: scale(1.2); }
      70%       { transform: scale(1); }
    }

    /* =============================================
       QUOTE CAROUSEL
    ============================================= */
    .quote-wrapper {
      position: relative;
      min-height: 88px;
      margin-bottom: 36px;
      opacity: 0;
      animation: fadeSlideUp 0.8s ease 0.9s forwards;
    }

    .quote {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      transition: opacity 0.8s ease, transform 0.8s ease;
      opacity: 0;
      transform: translateY(12px);
    }

    .quote.active {
      opacity: 1;
      transform: translateY(0);
    }

    .quote-text {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: clamp(0.95rem, 2.2vw, 1.15rem);
      color: rgba(255, 230, 235, 0.85);
      line-height: 1.65;
      max-width: 500px;
    }

    .quote-author {
      margin-top: 8px;
      font-size: 0.78rem;
      color: var(--blush);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-style: normal;
    }

    .quote-dots {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
    }

    .q-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: rgba(255,179,198,0.35);
      transition: background 0.4s, transform 0.4s;
    }
    .q-dot.active {
      background: var(--rose);
      transform: scale(1.4);
    }

    /* =============================================
       PHOTO / ILLUSTRATION STRIP
    ============================================= */
    .emoji-strip {
      display: flex;
      justify-content: center;
      gap: 20px;
      font-size: 2rem;
      margin-bottom: 36px;
      opacity: 0;
      animation: fadeSlideUp 0.8s ease 1.1s forwards;
    }

    .emoji-strip span {
      display: inline-block;
      animation: stripBounce 2s ease-in-out infinite;
      filter: drop-shadow(0 4px 8px rgba(255,45,85,0.4));
    }
    .emoji-strip span:nth-child(1) { animation-delay: 0s;    }
    .emoji-strip span:nth-child(2) { animation-delay: 0.2s;  }
    .emoji-strip span:nth-child(3) { animation-delay: 0.4s;  }
    .emoji-strip span:nth-child(4) { animation-delay: 0.6s;  }
    .emoji-strip span:nth-child(5) { animation-delay: 0.8s;  }

    @keyframes stripBounce {
      0%, 100% { transform: translateY(0)    scale(1); }
      50%       { transform: translateY(-8px) scale(1.15); }
    }

    /* =============================================
       BUTTONS
    ============================================= */
    .buttons-row {
      display: flex;
      gap: 20px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      opacity: 0;
      animation: fadeSlideUp 0.8s ease 1.35s forwards;
    }

    .btn {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 1.15rem;
      letter-spacing: 0.04em;
      border: none;
      border-radius: 60px;
      padding: 16px 44px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
    }

    /* YES button */
    .btn-yes {
      background: linear-gradient(135deg, #ff2d55, #c9003c, #ff6b8a);
      background-size: 200% 200%;
      color: white;
      box-shadow:
        0 8px 32px rgba(255, 45, 85, 0.45),
        0 2px 8px rgba(0,0,0,0.2),
        inset 0 1px 0 rgba(255,255,255,0.2);
      animation: yesGlow 2s ease-in-out infinite, yesShimmer 4s ease infinite;
    }

    @keyframes yesGlow {
      0%, 100% { box-shadow: 0 8px 32px rgba(255,45,85,0.45), 0 2px 8px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.2); }
      50%       { box-shadow: 0 12px 48px rgba(255,45,85,0.7), 0 2px 8px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.2); }
    }

    @keyframes yesShimmer {
      0%   { background-position: 0%   50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0%   50%; }
    }

    .btn-yes:hover {
      transform: translateY(-4px) scale(1.06);
      box-shadow: 0 16px 56px rgba(255, 45, 85, 0.65), inset 0 1px 0 rgba(255,255,255,0.2);
    }

    .btn-yes:active {
      transform: translateY(-1px) scale(0.98);
    }

    /* ripple on YES */
    .btn-yes::after {
      content: '';
      position: absolute;
      inset: -50%;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
      opacity: 0;
      transform: scale(0);
      transition: all 0.5s ease;
    }
    .btn-yes:active::after {
      opacity: 1;
      transform: scale(1);
      transition: all 0s;
    }

    /* NO button */
    .btn-no {
      background: rgba(255, 255, 255, 0.07);
      color: rgba(255, 180, 190, 0.65);
      border: 1.5px solid rgba(255, 100, 130, 0.25);
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      position: fixed; /* will be repositioned by JS */
      z-index: 20;
      font-size: 1rem;
      padding: 14px 34px;
      transition: background 0.3s, color 0.3s; /* no transform transition ‚Äî JS handles position */
    }

    /* =============================================
       UTILITY ANIMATIONS
    ============================================= */
    @keyframes fadeSlideUp {
      0%   { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* =============================================
       CELEBRATION MODAL
    ============================================= */
    .modal-overlay {
      position: fixed;
      inset: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      position: relative;
      max-width: 600px;
      width: 90%;
      background: linear-gradient(145deg, #2d0014, #1a000a, #3d001f);
      border: 1px solid rgba(255, 150, 170, 0.3);
      border-radius: 28px;
      padding: 52px 44px;
      text-align: center;
      box-shadow:
        0 0 100px rgba(255, 45, 85, 0.4),
        0 40px 100px rgba(0,0,0,0.6),
        inset 0 1px 0 rgba(255,200,210,0.1);
      transform: scale(0.7) translateY(60px);
      transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s;
      opacity: 0;
    }

    .modal-overlay.active .modal {
      transform: scale(1) translateY(0);
      opacity: 1;
    }

    .modal-icon {
      font-size: 5rem;
      display: block;
      animation: modalIconBounce 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.4s both;
      filter: drop-shadow(0 0 24px rgba(255,45,85,0.8));
    }

    @keyframes modalIconBounce {
      0%   { transform: scale(0) rotate(-15deg); }
      60%  { transform: scale(1.2) rotate(5deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    .modal-title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(1.8rem, 5vw, 2.8rem);
      font-weight: 900;
      font-style: italic;
      background: linear-gradient(135deg, #ffd700, #ff2d55, #ffb3c6, #ffd700);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: rainbowShift 3s ease infinite;
      margin: 18px 0 10px;
    }

    @keyframes rainbowShift {
      0%   { background-position: 0%   50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0%   50%; }
    }

    .modal-subtitle {
      font-family: 'Dancing Script', cursive;
      font-size: 1.3rem;
      color: var(--blush);
      margin-bottom: 24px;
    }

    .modal-quote {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 1.05rem;
      color: rgba(255, 235, 240, 0.85);
      line-height: 1.7;
      padding: 20px 24px;
      border-left: 3px solid var(--rose);
      background: rgba(255, 45, 85, 0.06);
      border-radius: 0 12px 12px 0;
      margin-bottom: 28px;
      text-align: left;
    }

    .modal-close-hint {
      font-size: 0.78rem;
      color: rgba(255,180,200,0.45);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-top: 20px;
      cursor: pointer;
      transition: color 0.3s;
    }
    .modal-close-hint:hover { color: rgba(255,180,200,0.9); }

    /* =============================================
       CONFETTI / FIREWORKS CANVAS
    ============================================= */
    #celebrationCanvas {
      position: fixed;
      inset: 0;
      z-index: 99;
      pointer-events: none;
    }

    /* =============================================
       FLOATING HEARTS (celebration burst)
    ============================================= */
    .float-heart {
      position: fixed;
      pointer-events: none;
      z-index: 98;
      font-size: var(--size, 24px);
      animation: floatHeartUp var(--dur, 3s) ease-out forwards;
      left: var(--x);
      bottom: var(--y);
    }

    @keyframes floatHeartUp {
      0%   { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
      100% { opacity: 0; transform: translateY(-90vh) scale(0.3) rotate(360deg); }
    }

    /* =============================================
       EXTRA CELEBRATORY BACKGROUND FLASH
    ============================================= */
    .color-flash {
      position: fixed;
      inset: 0;
      z-index: 97;
      pointer-events: none;
      opacity: 0;
      animation: colorFlash 0.6s ease forwards;
    }

    @keyframes colorFlash {
      0%   { opacity: 0.7; background: radial-gradient(circle, #ff2d55, transparent); }
      100% { opacity: 0; }
    }

    /* =============================================
       RESPONSIVE
    ============================================= */
    @media (max-width: 520px) {
      .card { padding: 40px 28px 44px; }
      .buttons-row { gap: 14px; }
      .btn { padding: 14px 32px; font-size: 1rem; }
      .modal { padding: 40px 28px; }
    }

    /* =============================================
       SCROLLBAR HIDE
    ============================================= */
    ::-webkit-scrollbar { display: none; }
  </style>
</head>
<body>

  <!-- Background layers -->
  <div class="bg-layer"></div>
  <div class="glow-blob glow-blob-1"></div>
  <div class="glow-blob glow-blob-2"></div>
  <div class="glow-blob glow-blob-3"></div>

  <!-- Ambient floating hearts -->
  <div class="ambient-hearts-container" id="ambientHearts"></div>

  <!-- =========== MAIN CARD =========== -->
  <main class="card" id="mainCard">
    <p class="eyebrow">‚ú¶ A message just for you ‚ú¶</p>

    <h1 class="headline">
      Will you be my<br>
      <span class="heart-icon">‚ô•</span> Valentine?
    </h1>

    <!-- Quote Carousel -->
    <div class="quote-wrapper" id="quoteWrapper">
      <!-- quotes injected by JS -->
      <div class="quote-dots" id="quoteDots"></div>
    </div>

    <!-- Decorative emoji strip -->
    <div class="emoji-strip">
      <span>üåπ</span><span>üíñ</span><span>ü•Ç</span><span>üíå</span><span>üå∏</span>
    </div>

    <!-- Buttons -->
    <div class="buttons-row" id="buttonsRow">
      <button class="btn btn-yes" id="btnYes" onclick="handleYes()">‚ù§Ô∏è Yes, always!</button>
    </div>
  </main>

  <!-- NO button (fixed, escapes on hover) -->
  <button class="btn btn-no" id="btnNo" onmouseenter="escapeNo()" ontouchstart="escapeNo()" onclick="escapeNo()">
    üíî No
  </button>

  <!-- =========== CELEBRATION MODAL =========== -->
  <div class="modal-overlay" id="modalOverlay" onclick="handleOverlayClick(event)">
    <div class="modal" id="celebModal">
      <span class="modal-icon" id="modalIcon">üíò</span>
      <h2 class="modal-title" id="modalTitle">LOVE YOU dee Shageetha ‚ù§Ô∏è</h2>
      <p class="modal-subtitle" id="modalSubtitle">You just made my heart skip a beat‚Ä¶</p>
      <blockquote class="modal-quote" id="modalQuote"></blockquote>
      <p class="modal-close-hint" onclick="closeModal()">‚ú¶ tap anywhere to continue celebrating ‚ú¶</p>
    </div>
  </div>

  <!-- Celebration canvas for confetti/fireworks -->
  <canvas id="celebrationCanvas"></canvas>

  <script>
    /* ============================================================
       DATA ‚Äî QUOTES
    ============================================================ */
    const mainQuotes = [
      { text: "In all the world, there is no heart for me like yours. In all the world, there is no love for you like mine.", author: "‚Äî Maya Angelou" },
      { text: "I would rather spend one lifetime with you, than face all the ages of this world alone.", author: "‚Äî J.R.R. Tolkien" },
      { text: "Every love story is beautiful, but ours is my favourite.", author: "‚Äî Unknown" },
      { text: "You are my today and all of my tomorrows.", author: "‚Äî Leo Christopher" },
      { text: "To love and be loved is to feel the sun from both sides.", author: "‚Äî David Viscott" },
    ];

    const celebrationQuotes = [
      { text: "You are the finest, loveliest, tenderest, and most beautiful person I have ever known‚Äîand even that is an understatement.", subtitle: "You just made me the happiest soul alive üåπ" },
      { text: "Whoever you are, I have always depended on the kindness of strangers ‚Äî but with you, I no longer need to. You are my home.", subtitle: "Together is my favourite place ‚ú®" },
      { text: "I fell in love the way you fall asleep: slowly, and then all at once.", subtitle: "Today belongs to us forever üíå" },
    ];

    /* ============================================================
       QUOTE CAROUSEL INIT
    ============================================================ */
    let currentQuote = 0;

    function buildQuoteCarousel() {
      const wrapper = document.getElementById('quoteWrapper');
      const dotsEl  = document.getElementById('quoteDots');

      mainQuotes.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'quote' + (i === 0 ? ' active' : '');
        div.innerHTML = `
          <p class="quote-text">"${q.text}"</p>
          <p class="quote-author">${q.author}</p>
        `;
        wrapper.insertBefore(div, dotsEl);

        const dot = document.createElement('div');
        dot.className = 'q-dot' + (i === 0 ? ' active' : '');
        dotsEl.appendChild(dot);
      });

      setInterval(() => {
        const quotes = document.querySelectorAll('.quote');
        const dots   = document.querySelectorAll('.q-dot');
        quotes[currentQuote].classList.remove('active');
        dots[currentQuote].classList.remove('active');
        currentQuote = (currentQuote + 1) % mainQuotes.length;
        quotes[currentQuote].classList.add('active');
        dots[currentQuote].classList.add('active');
      }, 4000);
    }

    /* ============================================================
       AMBIENT HEARTS
    ============================================================ */
    function spawnAmbientHeart() {
      const container = document.getElementById('ambientHearts');
      const emojis = ['‚ù§Ô∏è','üíñ','üíó','üíì','üíù','üåπ','üíï','‚ú®'];
      const el = document.createElement('div');
      el.className = 'ambient-heart';
      el.style.setProperty('--x', Math.random() * 100 + 'vw');
      el.style.setProperty('--size', (12 + Math.random() * 24) + 'px');
      el.style.setProperty('--dur',  (6 + Math.random() * 8) + 's');
      el.style.setProperty('--delay', Math.random() * 3 + 's');
      el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      container.appendChild(el);
      // clean up after animation
      setTimeout(() => el.remove(), 14000);
    }

    // Spawn ambient hearts periodically
    for (let i = 0; i < 12; i++) {
      setTimeout(spawnAmbientHeart, i * 600);
    }
    setInterval(spawnAmbientHeart, 1200);

    /* ============================================================
       NO BUTTON ‚Äî ESCAPE LOGIC
    ============================================================ */
    const btnNo = document.getElementById('btnNo');
    let noEscapeCount = 0;

    function positionNoButtonInitial() {
      // Place No button near the Yes button initially
      const card     = document.getElementById('mainCard');
      const cardRect = card.getBoundingClientRect();
      const noRect   = btnNo.getBoundingClientRect();

      const centerX = cardRect.left + cardRect.width / 2;
      const centerY = cardRect.top + cardRect.height - 80;

      btnNo.style.left = (centerX + 80) + 'px';
      btnNo.style.top  = centerY + 'px';
    }

    function escapeNo() {
      noEscapeCount++;

      const margin  = 80;
      const btnW    = btnNo.offsetWidth  || 130;
      const btnH    = btnNo.offsetHeight || 50;
      const maxX    = window.innerWidth  - btnW - margin;
      const maxY    = window.innerHeight - btnH - margin;

      // Try several random positions, pick one far from current
      let bestX = margin, bestY = margin, bestDist = 0;
      const curX = parseInt(btnNo.style.left) || window.innerWidth / 2;
      const curY = parseInt(btnNo.style.top)  || window.innerHeight / 2;

      for (let i = 0; i < 20; i++) {
        const rx = margin + Math.random() * maxX;
        const ry = margin + Math.random() * maxY;
        const dist = Math.hypot(rx - curX, ry - curY);
        if (dist > bestDist) { bestDist = dist; bestX = rx; bestY = ry; }
      }

      btnNo.style.left       = bestX + 'px';
      btnNo.style.top        = bestY + 'px';
      btnNo.style.transition = 'left 0.18s cubic-bezier(0.175, 0.885, 0.32, 1.275), top 0.18s cubic-bezier(0.175, 0.885, 0.32, 1.275)';

      // Shrink the No button more with each escape attempt (disappear slowly)
      const scale = Math.max(0.4, 1 - noEscapeCount * 0.04);
      btnNo.style.transform = `scale(${scale})`;
      btnNo.style.opacity   = Math.max(0.15, 1 - noEscapeCount * 0.05);
    }

    /* ============================================================
       YES BUTTON HANDLER
    ============================================================ */
    function handleYes() {
      // Pick a random celebration quote
      const q = celebrationQuotes[Math.floor(Math.random() * celebrationQuotes.length)];
      document.getElementById('modalQuote').textContent = `"${q.text}"`;
      document.getElementById('modalSubtitle').textContent = q.subtitle;

      // Show modal
      document.getElementById('modalOverlay').classList.add('active');

      // Flash effect
      const flash = document.createElement('div');
      flash.className = 'color-flash';
      document.body.appendChild(flash);
      setTimeout(() => flash.remove(), 700);

      // Start celebration
      startConfetti();
      burstFloatingHearts();

      // Hide no button
      btnNo.style.opacity    = '0';
      btnNo.style.pointerEvents = 'none';
    }

    /* ============================================================
       MODAL CLOSE
    ============================================================ */
    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('active');
    }

    function handleOverlayClick(e) {
      if (e.target === document.getElementById('modalOverlay')) {
        closeModal();
      }
    }

    /* ============================================================
       CONFETTI + FIREWORKS CANVAS
    ============================================================ */
    const canvas  = document.getElementById('celebrationCanvas');
    const ctx     = canvas.getContext('2d');
    let particles = [];
    let animFrame = null;
    let celebRunning = false;

    function resizeCanvas() {
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    /* Particle factory */
    function createConfettiParticle(x, y) {
      const colors = ['#ff2d55','#ffd700','#ffb3c6','#ff6b8a','#c9003c','#fff','#e8c7f3','#ffd6cc'];
      const shapes = ['rect','circle','heart'];
      return {
        x, y,
        vx: (Math.random() - 0.5) * 14,
        vy: -(Math.random() * 18 + 8),
        gravity: 0.4,
        color: colors[Math.floor(Math.random() * colors.length)],
        shape: shapes[Math.floor(Math.random() * shapes.length)],
        size: 5 + Math.random() * 10,
        rotation: Math.random() * Math.PI * 2,
        rotSpeed: (Math.random() - 0.5) * 0.25,
        life: 1,
        decay: 0.005 + Math.random() * 0.008,
      };
    }

    function launchFirework(x, y) {
      const count = 80 + Math.floor(Math.random() * 50);
      for (let i = 0; i < count; i++) {
        const angle = (Math.PI * 2 * i) / count;
        const speed = 3 + Math.random() * 10;
        const p = createConfettiParticle(x, y);
        p.vx = Math.cos(angle) * speed;
        p.vy = Math.sin(angle) * speed;
        particles.push(p);
      }
    }

    function drawHeart(ctx, x, y, size) {
      const s = size / 2;
      ctx.beginPath();
      ctx.moveTo(x, y + s * 0.3);
      ctx.bezierCurveTo(x, y - s * 0.3, x - s, y - s * 0.3, x - s, y + s * 0.2);
      ctx.bezierCurveTo(x - s, y + s * 0.8, x, y + s * 1.2, x, y + s * 1.4);
      ctx.bezierCurveTo(x, y + s * 1.2, x + s, y + s * 0.8, x + s, y + s * 0.2);
      ctx.bezierCurveTo(x + s, y - s * 0.3, x, y - s * 0.3, x, y + s * 0.3);
      ctx.closePath();
      ctx.fill();
    }

    function animateParticles() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      particles = particles.filter(p => p.life > 0);

      for (const p of particles) {
        p.x  += p.vx;
        p.y  += p.vy;
        p.vy += p.gravity;
        p.vx *= 0.99;
        p.rotation += p.rotSpeed;
        p.life -= p.decay;

        ctx.save();
        ctx.globalAlpha = Math.max(0, p.life);
        ctx.fillStyle   = p.color;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rotation);

        if (p.shape === 'rect') {
          ctx.fillRect(-p.size / 2, -p.size / 4, p.size, p.size / 2);
        } else if (p.shape === 'circle') {
          ctx.beginPath();
          ctx.arc(0, 0, p.size / 2, 0, Math.PI * 2);
          ctx.fill();
        } else {
          drawHeart(ctx, 0, -p.size / 2, p.size);
        }

        ctx.restore();
      }

      animFrame = requestAnimationFrame(animateParticles);
    }

    function startConfetti() {
      if (celebRunning) return;
      celebRunning = true;

      // Launch fireworks at several positions
      const positions = [
        { x: canvas.width * 0.25, y: canvas.height * 0.3 },
        { x: canvas.width * 0.75, y: canvas.height * 0.25 },
        { x: canvas.width * 0.5,  y: canvas.height * 0.2 },
        { x: canvas.width * 0.15, y: canvas.height * 0.5 },
        { x: canvas.width * 0.85, y: canvas.height * 0.45 },
      ];

      positions.forEach((pos, i) => {
        setTimeout(() => launchFirework(pos.x, pos.y), i * 350);
      });

      // Random ongoing fireworks for 6s
      let t = 0;
      const interval = setInterval(() => {
        launchFirework(
          Math.random() * canvas.width,
          Math.random() * canvas.height * 0.6
        );
        t++;
        if (t > 12) clearInterval(interval);
      }, 450);

      animateParticles();

      // Stop canvas after 12s
      setTimeout(() => {
        cancelAnimationFrame(animFrame);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        celebRunning = false;
      }, 12000);
    }

    /* ============================================================
       BURST FLOATING HEARTS (celebration)
    ============================================================ */
    function burstFloatingHearts() {
      const emojis   = ['‚ù§Ô∏è','üíñ','üíó','üíì','üíù','üíò','üåπ','‚ú®','üí´'];
      const count    = 30;

      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const el = document.createElement('div');
          el.className = 'float-heart';
          el.style.setProperty('--size', (18 + Math.random() * 32) + 'px');
          el.style.setProperty('--dur',  (2 + Math.random() * 3) + 's');
          el.style.setProperty('--x', (5 + Math.random() * 90) + 'vw');
          el.style.setProperty('--y', (Math.random() * 30) + 'px');
          el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
          document.body.appendChild(el);
          setTimeout(() => el.remove(), 5000);
        }, i * 100);
      }
    }

    /* ============================================================
       INIT
    ============================================================ */
    buildQuoteCarousel();

    // Delay No button placement until card is rendered
    window.addEventListener('load', () => {
      setTimeout(positionNoButtonInitial, 200);
    });

    // Reposition No button on resize
    window.addEventListener('resize', () => {
      // Re-clamp No button within viewport
      const btnW  = btnNo.offsetWidth  || 130;
      const btnH  = btnNo.offsetHeight || 50;
      const curX  = parseInt(btnNo.style.left) || 0;
      const curY  = parseInt(btnNo.style.top)  || 0;
      btnNo.style.left = Math.min(curX, window.innerWidth  - btnW - 10) + 'px';
      btnNo.style.top  = Math.min(curY, window.innerHeight - btnH - 10) + 'px';
    });
  </script>
</body>
</html>